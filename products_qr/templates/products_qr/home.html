<h1>Товары и QR</h1>

<form method="post" style="margin-bottom:1rem">
  {% csrf_token %}
  <label>ID товара:</label>
  <input name="product_id" inputmode="numeric" pattern="\d*" required>
  <button type="submit">Сгенерировать секретную ссылку</button>
</form>

{% if error %}
  <p style="color:#a00">{{ error }}</p>
{% endif %}

{% if public_url %}
  <p>Готово! Публичная ссылка:
     <a href="{{ public_url }}" target="_blank">{{ public_url }}</a>
  </p>

  {% if link.qr_image %}
    <h3>QR-код</h3>
    <p><img src="{{ link.qr_image.url }}" alt="QR" style="max-width:260px"></p>
    <p><a href="{{ link.qr_image.url }}" download>Скачать PNG</a></p>
  {% endif %}
{% endif %}

<hr>
<h3>Последние товары</h3>
<ul>
  {% for p in last_products %}
    <li>
      ID {{ p.id }} — {{ p.name }}
      <form method="post" style="display:inline">
        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ p.id }}">
        <button type="submit">Сгенерировать</button>
      </form>
    </li>
  {% empty %}
    <li>Пока нет товаров. Зайдите в <a href="/admin/products_qr/product/add/" target="_blank">админку</a> и добавьте.</li>
  {% endfor %}
</ul>
